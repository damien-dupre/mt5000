---
title: "Tutorial 9: Transformations and Tables in R Markdown Files"
subtitle: "MT5000 - Data Analytics & Visualization"
author: "Damien Dupr√©"
date: "Dublin City University"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    nature:
      highlightStyle: solarized-light
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include = FALSE}
# general options --------------------------------------------------------------
options(scipen = 999)
set.seed(42)
# chunk options ----------------------------------------------------------------
knitr::opts_chunk$set(
  cache.extra = knitr::rand_seed, 
  message = FALSE, 
  warning = FALSE, 
  error = FALSE, 
  echo = FALSE,
  cache = FALSE,
  eval = TRUE,
  comment = "", 
  fig.align = "center", 
  fig.retina = 3
  )
# libraries --------------------------------------------------------------------
library(tidyverse)
library(knitr)
library(kableExtra)
library(countdown)

# theme ------------------------------------------------------------------------
library(xaringanthemer)
style_mono_light(
  base_color = "#23395b",
  code_inline_background_color ="#23395b"
  )

# data -------------------------------------------------------------------------
titanic <- read_csv(here::here("data/titanic.csv"))
```

# Objectives

In this tutorial, with RStudio Cloud, we will see how to:

- Includes Transformation steps and include descriptive statistics in R Markdown files
- Present these descriptive statistics in a table in R Markdown files

---

class: inverse, mline, center, middle

# 1. Transformations and Tables in R Markdown files

---

# Requeriements

Before starting, we need to check that:

- You have created an account on RStudio cloud
- You have installed the required packages
- You have created a default R Markdown file
- An output document is created without errors we you press "knit" in the R Markdown file

---

# R Markdown Structure

We have seen last time that R Markdown files have 3 different types of content:

#### 1. The YAML

Corresponds to the metadata shown in the header of the ouput file (e.g., title, author, date, ...) and the type of output (e.g., pdf, html, doc, ...)

#### 2. The Text

Written in Markdown style (i.e., text without formatting), it is used as core description in the output document

#### 3. The Code

Inserted in the R Markdown inside "chunks", the code is processed when creating the output and can display figures and tables

---

# First Code Chunk

In the first code chunk, will be added all the actions that will be applied to the other chunks (e.g., code option, library used, data downloaded).

````markdown

`r ''````{r setup, include=FALSE}
# libraries -----------------------------------------------------------
library(tidyverse)
library(kableExtra)

# options -------------------------------------------------------------
opts_chunk$set(
  message = FALSE, 
  warning = FALSE, 
  error = FALSE, 
  echo = FALSE
  )
  
# data ----------------------------------------------------------------
titanic <- read.csv("/cloud/project/titanic.csv")
```

````

---

# Code Chunk Options

Chunk output can be customized with knitr options, arguments set in the {} of a chunk header. Above, we use five arguments:

- include = FALSE prevents code and results from appearing in the finished file. R Markdown still runs the code in the chunk, and the results can be used by other chunks.
- echo = FALSE prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.
- message = FALSE prevents messages that are generated by code from appearing in the finished file.
- warning = FALSE prevents warnings that are generated by code from appearing in the finished.
- fig.cap = "..." adds a caption to graphical results.

See the **[R Markdown Reference Guide](https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf)** for a complete list of knitr chunk options.

---

# Following Code Chunks

Once all the global actions have been defined in the first chunk, each of the following chunks have a specific target:
- Display a table
- Display a figure
- Creating an object to use its results (e.g., statistical model)

---

# Table Code Chunks

In R, creating a table is amongst the most difficult actions:
- There is no easy click and drop solution, everything is coded
- It involves not only the transformation leading to the table but also the table design

Example, to create descriptive statistics of the mean and standard deviation of the variable "fare" by "gender", it involves: 

```{r echo=TRUE}
titanic %>% 
  group_by(Sex) %>% 
  summarise(
    mean = mean(Fare),
    sd = sd(Fare)
  )
```

---

# Table Code Chunks

Many more possibilites to summarise the data are possible, for example:

```{r echo=TRUE}
titanic %>% 
  group_by(Sex) %>% 
  summarise(
    n = n(),
    mean = mean(Fare, na.rm = TRUE),
    sd = sd(Fare, na.rm = TRUE),
    min = min(Fare, na.rm = TRUE),
    max = max(Fare, na.rm = TRUE)
  )
```

Note the na.rm argument set to TRUE, it indicates that missing values are not taken into account

---

# Table Code Chunks

Once the transformation leading to the data constituting the table content is done, we have to define the table's design.

Table design depends on the type of output but, with the right packages, it shouldn't shouldn't influence your code.

Two set of packages are currently the most used: {kableExtra} or {gt}

- {kableExtra} contains a set of function to make a kbl() table beautiful (**[see the package's vignette](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html)**)

- {gt} stands for Grammar of Tables and appears to be the new thing in table design (**[see the package's vignette](https://gt.rstudio.com/)**)

---

# Using kbl() from {kableExtra}

To convert your raw data into a basic table, add the function kbl() at the end of the pipe chain as follow:

```{r echo=TRUE}
titanic %>% 
  group_by(Sex) %>% 
  summarise(
    mean = mean(Fare, na.rm = TRUE),
    sd = sd(Fare, na.rm = TRUE)
  ) %>% 
  kbl()
```

---

# Using kbl() from {kableExtra}

To have a nicer a pdf had TRUE to the argument booktabs as follow:

```{r echo=TRUE}
titanic %>% 
  group_by(Sex) %>% 
  summarise(
    mean = mean(Fare, na.rm = TRUE),
    sd = sd(Fare, na.rm = TRUE)
  ) %>% 
  kbl(booktabs = TRUE)
```

It doesn't impact html slides but it does on pdf_document output.

See **[more customisation possibilities for pdf_document here](https://haozhu233.github.io/kableExtra/awesome_table_in_pdf.pdf)**
---

class: middle, inverse

# Demonstration