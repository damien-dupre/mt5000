<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Tutorial 9: Transformations and Tables in R Markdown Files</title>
    <meta charset="utf-8" />
    <meta name="author" content="Damien Dupré" />
    <script src="tutorial_9_files/header-attrs-2.7/header-attrs.js"></script>
    <script src="tutorial_9_files/kePrint-0.0.1/kePrint.js"></script>
    <link href="tutorial_9_files/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Tutorial 9: Transformations and Tables in R Markdown Files
## MT5000 - Data Analytics &amp; Visualization
### Damien Dupré
### Dublin City University

---




# Objectives

In this tutorial, with RStudio Cloud, we will see how to:

- Includes Transformation steps and include descriptive statistics in R Markdown files
- Present these descriptive statistics in a table in R Markdown files

---

class: inverse, mline, center, middle

# 1. Transformations and Tables in R Markdown files

---

# Requeriements

Before starting, we need to check that:

- You have created an account on RStudio cloud
- You have installed the required packages
- You have created a default R Markdown file
- An output document is created without errors we you press "knit" in the R Markdown file

---

# R Markdown Structure

We have seen last time that R Markdown files have 3 different types of content:

#### 1. The YAML

Corresponds to the metadata shown in the header of the ouput file (e.g., title, author, date, ...) and the type of output (e.g., pdf, html, doc, ...)

#### 2. The Text

Written in Markdown style (i.e., text without formatting), it is used as core description in the output document

#### 3. The Code

Inserted in the R Markdown inside "chunks", the code is processed when creating the output and can display figures and tables

---

# First Code Chunk

In the first code chunk, will be added all the actions that will be applied to the other chunks (e.g., code option, library used, data downloaded).

````markdown

```{r setup, include=FALSE}
# libraries -----------------------------------------------------------
library(tidyverse)
library(kableExtra)

# options -------------------------------------------------------------
opts_chunk$set(
  message = FALSE, 
  warning = FALSE, 
  error = FALSE, 
  echo = FALSE
  )
  
# data ----------------------------------------------------------------
titanic &lt;- read.csv("/cloud/project/titanic.csv")
```

````

---

# Code Chunk Options

Chunk output can be customized with knitr options, arguments set in the {} of a chunk header. Above, we use five arguments:

- include = FALSE prevents code and results from appearing in the finished file. R Markdown still runs the code in the chunk, and the results can be used by other chunks.
- echo = FALSE prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.
- message = FALSE prevents messages that are generated by code from appearing in the finished file.
- warning = FALSE prevents warnings that are generated by code from appearing in the finished.
- fig.cap = "..." adds a caption to graphical results.

See the **[R Markdown Reference Guide](https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf)** for a complete list of knitr chunk options.

---

# Following Code Chunks

Once all the global actions have been defined in the first chunk, each of the following chunks have a specific target:
- Display a table
- Display a figure
- Creating an object to use its results (e.g., statistical model)

---

# Table Code Chunks

In R, creating a table is amongst the most difficult actions:
- There is no easy click and drop solution, everything is coded
- It involves not only the transformation leading to the table but also the table design

Example, to create descriptive statistics of the mean and standard deviation of the variable "fare" by "gender", it involves: 


```r
titanic %&gt;% 
  group_by(Sex) %&gt;% 
  summarise(
    mean = mean(Fare),
    sd = sd(Fare)
  )
```

```
# A tibble: 2 x 3
  Sex     mean    sd
  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 female  46.2  63.3
2 male    NA    NA  
```

---

# Table Code Chunks

Many more possibilites to summarise the data are possible, for example:


```r
titanic %&gt;% 
  group_by(Sex) %&gt;% 
  summarise(
    n = n(),
    mean = mean(Fare, na.rm = TRUE),
    sd = sd(Fare, na.rm = TRUE),
    min = min(Fare, na.rm = TRUE),
    max = max(Fare, na.rm = TRUE)
  )
```

```
# A tibble: 2 x 6
  Sex        n  mean    sd   min   max
  &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 female   466  46.2  63.3  6.75  512.
2 male     843  26.2  42.5  0     512.
```

Note the na.rm argument set to TRUE, it indicates that missing values are not taken into account

---

# Table Code Chunks

Once the transformation leading to the data constituting the table content is done, we have to define the table's design.

Table design depends on the type of output but, with the right packages, it shouldn't shouldn't influence your code.

Two set of packages are currently the most used: {kableExtra} or {gt}

- {kableExtra} contains a set of function to make a kbl() table beautiful (**[see the package's vignette](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html)**)

- {gt} stands for Grammar of Tables and appears to be the new thing in table design (**[see the package's vignette](https://gt.rstudio.com/)**)

---

# Using kbl() from {kableExtra}

To convert your raw data into a basic table, add the function kbl() at the end of the pipe chain as follow:


```r
titanic %&gt;% 
  group_by(Sex) %&gt;% 
  summarise(
    mean = mean(Fare, na.rm = TRUE),
    sd = sd(Fare, na.rm = TRUE)
  ) %&gt;% 
  kbl()
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Sex &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; mean &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; sd &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; female &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46.1981 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63.29260 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; male &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 26.1546 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42.48688 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

# Using kbl() from {kableExtra}

To have a nicer a pdf had TRUE to the argument booktabs as follow:


```r
titanic %&gt;% 
  group_by(Sex) %&gt;% 
  summarise(
    mean = mean(Fare, na.rm = TRUE),
    sd = sd(Fare, na.rm = TRUE)
  ) %&gt;% 
  kbl(booktabs = TRUE)
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Sex &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; mean &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; sd &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; female &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46.1981 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63.29260 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; male &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 26.1546 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42.48688 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

It doesn't impact html slides but it does on pdf_document output.

See **[more customisation possibilities for pdf_document here](https://haozhu233.github.io/kableExtra/awesome_table_in_pdf.pdf)**
---

class: middle, inverse

# Demonstration
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "solarized-light",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
